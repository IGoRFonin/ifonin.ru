---
title: "Когда контекст проекта становится бременем: как я сделал команду /audit-claude-md"
date: 2026-02-23
lastmod: 2026-02-23
description: "История создания команды /audit-claude-md для анализа и оптимизации CLAUDE.md файлов. Как я сократил контекст на 6-7 тысяч токенов и научился правильно управлять token budget в Claude Code."
tags: ["claude-code", "ai", "productivity", "tools"]
slug: "audit-claude-md-kontekst-proekta"
draft: false
---

Работая с Claude Code, я столкнулся с проблемой: CLAUDE.md разрастался, правила копировались, MCP серверы съедали половину окна. Нужен был инструмент для диагностики, и я создал команду `/audit-claude-md`.

## Почему это важно

В Claude Sonnet 4.5 окно контекста - 200K токенов. У Opus 4.6 в бета-режиме - 1M. Кажется много, но заканчивается быстро.

Я подключил несколько MCP серверов для работы с проектом. Они съели 40-60% токенов до первого промпта. Оставалось мало места.

CLAUDE.md загружается в каждой сессии. Я добавлял архитектуру, правила оформления кода, инструкции по сборке. Файл разросся до 2000 токенов с лишним.

Модели теряют внимание при больших контекстах. Я давал Claude больше информации, но результаты ухудшались. Мне нужен был инструмент для аудита - где уходят токены, что дублируется, что устарело.

## Что такое /audit-claude-md

Slash-команда для Claude Code. Запуск - `/audit-claude-md`.

Команда сканирует CLAUDE.md проекта - основной файл контекста, который определяет поведение Claude в вашем проекте.

Измеряет размер. Оценивает потребление токенов. Находит дублирование, устаревшие ссылки, недостающие документы. Проверяет конфликты между инструкциями.

Я запустил команду на своём проекте "угадай мелодию" с фронтом и бекендом. Выяснилось, что я знал про встроенную команду `/context`, но не мог правильно использовать её. Команда систематизировала всё - показала потери, бардак, места для экономии токенов.

Вывод - actionable audit. Получаешь не абстрактные советы, а список конкретных проблем с указанием файлов и строк.

## Как это работает: от теории к практике

**Фаза 1: Сканирование**

Команда анализирует CLAUDE.md проекта. Размер измеряется в байтах и токенах. Проверяется структура, читаемость, наличие дублирования.

В моём CLAUDE.md обнаружилось много избыточной информации. Описание архитектуры занимало несколько экранов, инструкции по code style дублировались, ссылки на документацию вели на устаревшие версии.

**Фаза 2: Анализ и предложения**

Команда предлагает конкретные улучшения: создать rules для разных аспектов проекта, организовать сабдиректории для структурирования контекста, удалить ненужную информацию.

Пример из моего проекта: команда показала, что описание API endpoints занимает больше места, чем нужно. Предложила вынести детали в отдельный rules файл, оставив в CLAUDE.md только ключевые моменты.

Нашлись устаревшие инструкции по сборке проекта - я перешёл на другой bundler месяц назад, но забыл обновить документацию. Claude продолжал получать неактуальную информацию.

**Фаза 3: Рекомендации**

Команда предлагает структуру для лучшей организации. Вместо одного большого CLAUDE.md - разделение на основной файл и rules в сабдиректориях. Каждый aspect проекта (архитектура, code style, testing) - отдельный rules файл.

Предложения требуют вашего решения. Команда не меняет файлы автоматически - она анализирует и рекомендует. Вы решаете, что применить.

**Фаза 4: Отчёт**

Результаты выводятся прямо в консоль с ASCII диаграммами. Показывается распределение токенов, топ проблемных секций, рекомендации по оптимизации.

Визуализация помогает быстро понять, где основные потери. Не нужно читать длинный текстовый отчёт - видишь диаграмму и сразу понимаешь проблему.

## Архитектура команды

Команда реализована как Markdown файл в `.claude/commands/` с YAML frontmatter - стандартный паттерн для создания slash-команд в Claude Code согласно официальной документации.

Frontmatter содержит конфигурацию: какие инструменты разрешены (Read, Grep, Glob, Bash с ограничением на git команды), описание команды, подсказку для аргументов. Тело файла - инструкции для Claude.

Команда работает с CLAUDE.md текущего проекта автоматически.

Используются проверенные паттерны: directory traversal для рекурсивного обхода файлов, pattern matching для поиска дублирования, heuristics для оценки token count без вызова API.

Почему именно так?

Никаких сложных API, никаких внешних зависимостей. Всё работает через Markdown и инструкции. Claude Code читает файл, парсит frontmatter, выполняет инструкции. Просто. Работает из коробки.

Сначала я планировал полноценный plugin с `plugin.json`, отдельными skills, hooks. Для личного инструмента глобальная команда оказалась достаточной. Доступна во всех проектах, не требует настройки.

Начинай с простого решения. Если понадобится больше - перейдёшь к plugin позже.

## Практические результаты

Я сократил мой CLAUDE.md с двух тысяч токенов до примерно 1200 без потери информации. Убрал дублирование в rules - большая часть инструкций дублировалась просто потому, что я не помнил, что уже добавлял их раньше.

Экономия токенов в моём проекте - около 6-7 тысяч на каждую сессию. Для проектов с большими контекстами критично. Вместо упора в лимит окна на середине работы теперь есть запас.

Теперь я провожу аудит контекста еженедельно. Запускаю команду, читаю отчёт, вношу изменения. Занимает минут десять.

Команда работает на любом проекте с Claude Code структурой. Удобно, когда начинаешь работать с чужим кодом - сразу видишь, как настроен контекст, где узкие места.

## Как использовать эту команду

Файл команды находится глобально в системе Claude Code и доступен во всех проектах. Не нужно копировать ничего - просто запускай.

Открываешь проект в Claude Code. Запускаешь `/audit-claude-md`.

Отчёт выводится прямо в консоль с ASCII диаграммами. Видишь распределение токенов по секциям CLAUDE.md, топ проблем, рекомендации по структуре.

Читаешь рекомендации. Применяешь те, что имеют смысл для твоего проекта. Команда предлагает - ты решаешь.

Основные типы рекомендаций:
- Создание rules файлов для разделения concerns
- Организация сабдиректорий в `.claude/` для структурирования
- Удаление устаревшей или избыточной информации
- Оптимизация формулировок для экономии токенов

Применяй изменения постепенно. Запусти команду снова после правок - увидишь прогресс.

---

Контекст в Claude Code - операционная модель. Как ты организуешь информацию, как управляешь token budget, как балансируешь между подробностью и лаконичностью - всё это влияет на качество работы с моделью.

Команда `/audit-claude-md` помогает держать эту модель под контролем. Превращает интуитивное чувство "что-то здесь не так" в конкретные данные и actionable рекомендации.
